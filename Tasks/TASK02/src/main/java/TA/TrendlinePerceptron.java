package TA;

public class TrendlinePerceptron {
    double[] x;
    double y;
    double w;
    double trendline; // Добавляем параметр трендлайна
    double learningRate = 0.1;

    public TrendlinePerceptron(double initialTrendline) {
        x = new double[1]; // Вход - разница между ценой и трендлайном
        w = Math.random() * 0.2 + 0.1;
        trendline = initialTrendline;
        System.out.println("Начальный вес: " + w);
    }

    public void calculateDifference(double price) {
        x[0] = price - trendline;
    }

    public void calculateOutput() {
        y = x[0] * w;
        if (y > 0.5)
            y = 1;
        else
            y = 0;
    }

    public void updateWeight(double target) {
        double error = target - y;
        w += learningRate * error * x[0];
    }

    public void train(double[] prices) {
        for (double price : prices) {
            calculateDifference(price);
            calculateOutput();
            updateWeight(1); // 1 указывает, что цена выше трендлайна
        }
    }

    public int test(double price) {
        calculateDifference(price);
        calculateOutput();
        return (int) y;
    }

    public static void main(String[] args) {
        // Замените на фактическое значение трендлайна
        double initialTrendline = 162.0;

        double[] prices = { 162.9900000, 162.3400000, 162.2000000, 162.1600000, 162.2000000, 161.6800000, 162.0200000, 162.2000000, 162.0100000, 161.8800000, 161.6500000, 161.6100000, 161.5500000, 161.6700000, 162.2900000, 161.9600000, 162.7000000, 162.5300000, 162.5800000, 163.1400000, 162.9900000, 163.2100000, 162.7700000, 162.3000000, 162.4800000, 162.6400000, 162.5800000, 162.4800000, 164.3800000, 164.1900000, 164.3800000, 163.1600000, 163.2600000, 162.8600000, 162.5700000, 162.7000000, 162.4900000, 162.1300000, 162.4800000, 162.1600000, 162.4700000, 162.8900000, 163.4100000, 162.9500000, 162.4900000, 163.0300000, 163.1200000, 163.2100000, 162.9000000, 162.5700000, 163.0100000, 163.0200000, 162.9300000, 163.0500000, 163.1600000, 164.1700000, 164.9000000, 165.0600000, 165.6000000, 165.1500000, 165.5700000, 165.3800000, 164.4300000, 164.4200000, 164.7500000, 164.5500000, 164.7300000, 164.6900000, 164.6500000, 165.0700000, 165.4000000, 166.3100000, 165.8000000, 166.0100000, 165.8300000, 166.3600000, 166.3600000, 166.6000000, 166.2600000, 166.4400000, 166.2700000, 166.2100000, 166.1800000, 167.1500000, 167.0900000, 166.5900000, 167.0800000, 166.9100000, 167.1000000, 166.2600000, 165.8300000, 165.4700000, 165.2100000, 165.4700000, 165.8700000, 165.6000000, 165.5800000, 166.7500000, 167.0900000, 166.6800000, 166.8900000, 167.1000000, 167.8200000, 167.7300000, 167.2900000, 168.0000000, 167.9000000, 167.8100000, 168.1500000, 168.2200000, 168.4300000, 168.4600000, 167.8400000, 167.8000000, 167.4100000, 167.4100000, 167.7700000, 167.7400000, 167.8800000, 167.5000000, 167.4800000, 167.9300000, 167.8000000, 167.8500000, 167.8800000, 167.1800000, 167.0300000, 167.1300000, 167.5700000, 169.1400000, 171.4600000, 170.9700000, 170.9900000, 171.0000000, 170.7000000, 170.9100000, 171.2500000, 171.3700000, 171.8600000, 170.3900000, 170.6100000, 169.8200000, 170.3900000, 170.4300000, 169.9300000, 169.6900000, 169.6500000, 170.4800000, 170.1000000, 169.8300000, 169.9300000, 169.7700000, 169.8700000, 168.9900000, 169.2500000, 169.5000000, 170.7600000, 170.6900000, 170.3900000, 170.1300000, 169.7800000, 170.6500000, 170.1600000, 170.0900000, 170.1000000, 170.2100000, 170.1900000, 169.7200000, 169.8200000, 169.4200000, 169.9400000, 170.5900000, 169.7000000, 169.9000000, 169.8900000, 169.6500000, 169.5700000, 169.7500000, 169.8100000, 169.6900000, 169.6400000, 169.2700000, 169.8300000, 170.0700000, 170.6400000, 170.6000000, 171.1700000, 170.7800000, 170.4000000, 170.5200000, 170.4000000, 170.1800000, 170.6100000, 170.4000000, 170.2000000, 170.1000000, 170.3800000, 170.4200000, 170.0000000, 169.9100000, 169.7600000, 169.6900000, 169.9000000, 169.7500000, 169.7400000, 169.7000000, 169.7600000, 168.2000000, 168.4100000, 167.1500000, 167.9200000, 168.3300000, 168.3600000, 168.8300000, 168.7300000, 168.2200000, 168.2200000, 168.3300000, 168.5400000, 168.7000000, 166.7300000, 165.9600000, 165.8000000, 165.9100000, 166.9600000, 167.7800000, 167.5400000, 167.1700000, 167.3300000, 168.1900000, 167.6500000, 167.0100000, 166.9200000, 166.9700000, 165.6600000, 166.4000000, 166.9100000, 166.2000000, 166.9200000, 166.6900000, 166.6200000, 166.6800000, 167.0000000, 167.1300000, 167.0100000, 166.5200000, 166.8100000, 166.2600000, 166.5300000, 166.5600000, 166.4500000, 166.6600000, 166.1800000, 166.3900000, 166.6400000, 166.5500000, 167.5400000, 168.0600000, 168.1300000, 168.0000000, 167.7700000, 167.9100000, 167.9500000, 168.0900000, 168.0500000, 169.4900000, 168.8500000, 168.4600000, 168.5900000, 168.0100000, 167.9000000, 168.0200000, 168.2900000, 168.0000000, 168.0800000, 168.1700000, 168.0900000, 167.8800000, 167.8800000, 166.6300000, 166.9100000, 166.7000000, 166.8400000, 166.9300000, 166.6400000, 167.2000000, 167.0300000, 167.6200000, 166.9400000, 166.8500000, 166.9900000, 167.0700000, 166.8600000, 167.0500000, 167.4800000, 167.4500000, 167.4300000, 167.3100000, 167.3300000, 167.1100000, 166.9300000, 166.7500000, 166.8600000, 166.9000000, 166.9300000, 166.8700000, 166.8200000, 166.1800000, 166.1600000, 166.0200000, 166.0000000, 166.4100000, 166.2600000, 166.0000000, 166.3200000, 166.4000000, 166.1300000, 166.1300000, 165.7900000, 165.6200000, 165.5000000, 166.5100000, 166.3300000, 165.8800000, 165.6800000, 165.8400000, 165.9400000, 165.9700000, 165.7000000, 165.3500000, 165.7700000, 165.8300000, 165.8500000, 165.8600000, 165.7100000, 166.3300000, 166.9700000, 166.7400000, 166.9200000, 166.9900000, 166.5500000, 166.3800000, 166.5000000, 166.9800000, 166.7800000, 166.6100000, 166.6800000, 166.6000000, 166.3600000, 166.1500000, 166.2100000, 166.1000000, 166.1000000, 166.1800000, 166.2100000, 166.4700000, 166.5100000, 166.8100000, 166.5500000, 166.7000000, 166.4900000, 166.5500000, 166.3400000, 168.2900000, 167.9300000, 167.4800000, 167.1700000, 167.2500000, 167.0300000, 167.4500000, 167.4300000, 167.7000000, 167.4800000, 167.4900000, 167.4000000, 167.4600000, 167.5900000, 168.3400000, 168.0000000, 167.9300000, 167.9600000, 168.0000000, 168.0900000, 167.6100000, 168.0700000, 168.4600000, 168.7200000, 168.6600000, 168.8100000, 168.7200000, 168.8500000, 170.1900000, 170.4500000, 170.2500000, 170.3500000, 170.1200000, 170.5000000, 170.3700000, 170.1600000, 170.4500000, 169.8100000, 170.1100000, 170.1000000, 170.3000000, 170.3000000, 169.6200000, 169.4600000, 168.9000000, 169.2300000, 169.0400000, 169.3200000, 169.4900000, 169.2700000, 169.0300000, 169.1200000, 169.1500000, 169.1000000, 169.1900000, 168.9600000, 168.8400000, 169.5800000, 169.4000000, 169.7100000, 169.4500000, 169.4400000, 169.2800000, 169.3200000, 169.8400000, 169.5800000, 169.6200000, 169.7300000, 169.7700000, 169.7000000, 169.6800000, 170.7000000, 170.9200000, 170.6100000, 170.5900000, 170.5000000, 170.0200000, 170.0400000, 170.4500000, 170.6500000, 170.4000000, 170.5700000, 170.7600000, 170.6300000, 171.4900000, 171.5300000, 171.5000000, 171.8000000, 172.9300000, 173.7500000, 173.8700000, 174.2600000, 174.5000000, 174.4900000, 174.8900000, 174.9500000, 174.8400000, 174.8900000, 173.9600000, 174.2400000, 173.3500000, 173.2100000, 173.4800000, 173.0500000, 173.4400000, 173.5800000, 173.0400000, 172.7600000, 173.2000000, 173.3100000, 173.1000000, 173.0400000, 172.2000000, 171.8700000, 171.8600000, 172.0000000, 172.2900000, 172.2300000, 172.4000000, 172.1000000, 171.9300000, 171.7200000, 170.1700000, 170.1600000, 170.5400000, 169.9200000, 170.4600000, 170.6900000, 170.7900000, 170.4400000, 171.2300000, 171.0000000, 171.5600000, 171.4900000, 171.6000000, 171.4700000, 171.2200000 };
        TrendlinePerceptron perceptron = new TrendlinePerceptron(initialTrendline);
        perceptron.train(prices);

        // Тест с новой ценой
        double newPrice = 162.0; // Замените на новую цену, которую вы хотите протестировать
        int result = perceptron.test(newPrice);
        System.out.println("Предсказано: " + result);
    }
}
